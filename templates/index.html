{% extends "basecats.html" %}
{% block title %}
        PMU  MEXICO
{% endblock %}
{% block content %}
{% load static %}
<div style="text-align: center; margin-left: 2rem; margin-right: 3rem;">
  <!--SVG for Map Background-->
  <svg class="map-cont" id="map_bg" ></svg>
  <defs>
    <marker
      id="thearrow"
      markerUnits="strokeWidth"
      markerWidth="12"
      markerHeight="12"
      viewBox="0 0 12 12"
      refX="6"
      refY="6"
      orient="auto">
      <path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill: #f00;"></path>
    </marker>
  </defs>
</div>
  

  <script>
    var current_id=1
var color_loc= '#14213D'
var Freq = ['','','','','','','','',''];
var angle= ['','','','','','','','',''];
var vtg=['','','','','','','','',''];
function update_data() {
   return data = [
    {   
    "index": 0,
		"lat": 20.7,
		"lon": -103.4,
    'id': 'guadalajara',
    'freq':Freq[0],
    'angle':angle[0],
    'fill':'#FF8427',

	},
	{
		"index": 1,
    "lat": 19.2,
		"lon": -99.2,
		"field": "Hz",
    'id': 'CDMX',
    'freq':Freq[1],
    'angle':angle[1],
    'fill':'#51bbfe',
	}, 
    {   
    "index": 2,
    "lat": 25.7,
		"lon": -100.2,
		"field": "Hz",
    'id': 'monterrey'	,
    'freq':Freq[2],
    'angle':angle[2],
    'fill':'#3D5A6C',
	},
    {   
    "index": 3,
    "lat": 19.7,
		"lon": -101.2,
		"field": "Hz",
    'id': 'morelia'	,
    'freq':Freq[3],
    'angle':angle[3],
    'fill':'#FFC800'	
	},
    {   
    "index": 4,
		"lat": 23.3,
		"lon": -106.4,
		"field": "Hz",	
    'id': 'mazatlán',
    'freq':Freq[4],
    'angle':angle[4],
    'fill':'#A393BF',
	},
    {   
      "index": 5,
		"lat": 18.5,
		"lon": -88.3,
		"field": "Hz",	
    'id': 'chetumal',
    'freq':Freq[5],
    'angle':angle[5],
    'fill':'#4D8B31'
	},
    {   
    "index": 6,
		"lat": 13.7,
		"lon": -89.2,
		"field": "Hz",	
    'id': 'el salvador',
    'freq':Freq[6],
    'angle':angle[6],
    'fill':'red',
	},
  {   
		"index": 7,
    "lat": 31.74,
		"lon": -106.44,
		"field": "Hz",	
    'id': 'cd. juárez',
    'freq':Freq[7],
    'angle':angle[7],
    'fill':'#F08CAE',
	},
  {   
    "index": 8,
		"lat": 16.74,
		"lon": -93.17,
		"field": "Hz",	
    'id': 'chiapas',
    'freq':Freq[8],
    'angle':angle[8],
    'fill':'#950952'
	}
 
  
]}

data=update_data()


    
     // INITIALIZING VARIABLES
    // The svg canvas on which the topojson map is generated.
    const map_background_svg = d3.select("#map_bg");
    // Width and height of the map window, adjusted by screen size.
    
    map_background_svg.style('background-color', 'rgb(171,205,239)');
    // Width and height of the map window, adjusted by screen size.
    var width;
    var height;

    const requestData = async function () {

      width = map_background_svg.node().getBoundingClientRect().width;
      height = map_background_svg.node().getBoundingClientRect().height;


       // MX Map
       const map = map_background_svg.append("g")
       const grid = map_background_svg.append("g")
       grid.attr('class', 'text1')

      const mapZone= await d3.json("{% static 'media/json/Zonesmap.topojson' %}")
      //console.log(mapZone)
      var areas = topojson.feature(mapZone, mapZone.objects.collection);      
      var areasMesh = topojson.mesh(mapZone, mapZone.objects.collection);
      //var zoom = d3.zoom().on("zoom", zoomed);
      
      var projection = d3.geoMercator().scale(1400).center([-114, 23.0]).translate([width / 4, height / 2]);
      var path = d3.geoPath().projection(projection);

        let map_outline = map.selectAll("path.area_outline")
        .data([areasMesh])
        .join("path")
        .attr("class", "area_outline")
        .attr("d", path)
        .attr("z-index", "0")
        .attr("fill", "#A2E0C6")
        .attr("stroke", "#5C7457")
        .attr("stroke-width", "1.5px")
        .style("stroke-linejoin", "round")
        .on('click', function(d, i) {
          console.log("You clicked", d), i;
        })
        .attr('transform', 'translate(0,0)');

    
        
      
            
           

      let window_info_width = 320;
      let window_info_height = 230;

      // now add the tooltip
      let window_info = map_background_svg.append("g")
        .attr("class", "window_info")
        .attr("id", "window_info")
        .attr("visibility", "visible")
        .style("z-index", 99);

        var x_w =820
        var y_w=40

        window_info.append("rect")
        .attr("fill", "rgba(222,239,243,0.6)")
        .attr("x", x_w)
        .attr("y", y_w)
        .attr("rx", 10)
        .attr("ry", 10)
        .attr('class', 'window')
        .style("z-index", 99)
        .attr("width", window_info_width)
        .attr("height", window_info_height);


      window_info.append("text")
        .attr("font-size", "20px")
        .attr('fill', '#14213D')
        .attr('font-weight', 'bold')
        .text("Positive Frequency Phasor")
        .attr("x", x_w+20)
        .attr("y", y_w+30);

        window_info.append("rect")
        .attr("fill", "rgba(255,255,255,0.4)")
        .attr('visibility', 'hidden') 
        .attr("x", x_w+15)
        .attr("y", y_w+60)
        .attr("rx", 0)
        .attr("ry", 0)
        .attr("width", window_info_width*0.9)
        .attr("height", window_info_height*0.6);

        var cx_ph=x_w+15+window_info_width*0.30       
        var cy_ph=y_w+60+window_info_height*0.3
        var r_ph=60
        console.log(cx_ph, cy_ph)

        window_info.append("circle")
          .attr('cx',cx_ph)
          .attr('cy', cy_ph)
          .attr('r',r_ph)
          .attr("fill", "none")
          .attr('stroke-width', "3px")
          .attr('stroke', "#14213D")

        window_info.append("text")
        .attr("fill", "#EC3115")
        .attr("font-size", "10px")
        .attr('fill', '#14213D')
        .attr('font-weight', '400')
        .text("0°")
        .attr("x",cx_ph+r_ph+5)
        .attr("y", cy_ph);
        
        window_info.append("text")
        .attr("fill", "#EC3115")
        .attr("font-size", "10px")
        .attr('fill', '#14213D')
        .attr('font-weight', '400')
        .text("180°")
        .attr("x",cx_ph-r_ph-23)
        .attr("y", cy_ph);

        window_info.append("text")
        .attr("fill", "#EC3115")
        .attr("font-size", "10px")
        .attr('fill', '#14213D')
        .attr('font-weight', '400')
        .text("90°")
        .attr("x",cx_ph-10)
        .attr("y", cy_ph-r_ph-5);

        window_info.append("text")
        .attr("fill", "#EC3115")
        .attr("font-size", "10px")
        .attr('fill', '#14213D')
        .attr('font-weight', '400')
        .text("270°")
        .attr("x",cx_ph-10)
        .attr("y", cy_ph+r_ph+14);

      data_line=[{'fill':'#4D8B31'}, {'fill':'#3D5A6C'},{'fill':'#FFC800'},{'fill':'#FF8427'},{'fill':'#A393BF'}, {'fill':'red'},
                 {'fill':'#950952'}, {'fill':'#F08CAE'},{'fill':'#51bbfe'}]

      data_t=['chetumal', 'monterrey', 'morelia', 'guadalajara', 'mazatlán', 'el salvador', 'chiapas', 'cd. juárez', 'CDMX'  ]

       window_info.selectAll('line')
        .attr("d", path)
        .data(data_line)
        .enter().append('line')      
        .attr('x1',cx_ph)
        .attr('y1',cy_ph)
        .attr('x2',cx_ph+r_ph-8)
        .attr('y2',cy_ph) 
        .attr('stroke-width', "3px")  
        .attr("marker-end",  function (d, i) {return `url(#triangle${i})`})
        .attr('stroke', function (d) {return d.fill})
        .attr('fill', function (d) {return d.fill})
        .attr("transform", "rotate(-45 931 169)") ;


       //arrow `Hello ${name}!`
       window_info.selectAll("svg")
        .attr("d", path)
        .data(data_line)
        .enter().append("svg:defs").append("svg:marker")
        .attr("id", function (d, i) {return`triangle${i}`})
        .attr("refX", 6)
        .attr("refY", 6)
        .attr("markerWidth", 30)
        .attr("markerHeight", 30)
        .attr("markerUnits","userSpaceOnUse")
        .attr("orient", "auto")
        .append("path")
        .attr("d", "M 0 0 12 6 0 12 3 6")
        .style("fill", function (d) {return d.fill});

      window_info.append("circle")
      .attr('cx',cx_ph)
      .attr('cy', cy_ph )
      .attr('r',3)
      .attr("fill", "#14213D")
      .attr('stroke-width', "3px")
      .attr('stroke', "#14213D")

      static_text=window_info.append('g')
      static_text.selectAll('circle')
        .attr("d", path)
        .data(data_line)
        .enter().append("circle")
        .attr("fill", function (d) {return d.fill})
        .attr("cx", x_w+210)
        .attr("cy", function (d,i) {return y_w+71+17*i})
        .attr("r", 5);

      static_text.selectAll('text')
        .attr("d", path)
        .data(data_t)
        .enter().append("text")
        .attr("font-size", "10px")
        .attr('fill', '#14213D')
        .attr('font-weight', '400')
        .text(function (d) {return d})
        .attr("x", x_w+230)
        .style('text-transform', 'capitalize')
        .attr("y", function (d,i) {return y_w+75+17*i});
        

            
          window_info.on("click", function () { 
              var pos=d3.mouse(this)
              console.log(pos)
             } )

          // CREATE LINE 1    

        let LineCHTMAL = grid.append("line")
          .attr('x1',936 - 1)
          .attr('y1', 436 )
          .attr('x2', 672+3)
          .attr('y2', 418)
          .attr('z-index', 1)
          .attr('stroke-width', "3px")
          .attr('stroke', "grey")

         grid.append("circle")
          .attr("cx", 802)
          .attr("cy", 426)
          .attr("r", 13)
          .attr("id", "circle1")
          .attr("fill", "#DEDEDE")

        ang1 = grid.append("text")
          .attr("x", (792))
          .attr("y", (425 + 3))
          .attr("font-size", "9px")
          .attr("id", "angle1")
          .attr('class', 'Tangle')
          .attr("font-family", "Century Gothic")
          .attr("font-weight", "bold")
          .text('81' + "°");


           // CREATE LINE 2

           let LineMTREY = grid.append("line")
          .attr('x1',647 )
          .attr('y1', 245+6)
          .attr('x2', 672)
          .attr('y2', 418-3)
          .attr('z-index', -1)
          .attr('stroke-width', "3px")
          .attr('stroke', "grey")

         grid.append("circle")
          .attr("cx", 658)
          .attr("cy", 320)
          .attr("r", 13)
          .attr("id", "circle2")
          .attr("fill", "#DEDEDE")

        ang2 = grid.append("text")
          .attr("x", (658 - 8))
          .attr("y", (320 + 3))
          .attr("font-size", "9px")
          .attr("id", "anlge2")
          .attr('class', 'Tangle')
          .attr("font-family", "Century Gothic")
          .attr("font-weight", "bold")
          .text('24' + "°");

          
           // CREATE LINE 2

        let LineMRLIA = grid.append("line")
          .attr('x1',622 + 3.9)
          .attr('y1', 404+2)
          .attr('x2', 672-3.5)
          .attr('y2', 418)
          .attr('z-index', -1)
          .attr('stroke-width', "3px")
          .attr('stroke', "grey")

         grid.append("circle")
          .attr("cx", 648)
          .attr("cy", 413 -3)
          .attr("r", 13)
          .attr("id", "circle3")
          .attr("fill", "#DEDEDE")

        ang3 = grid.append("text")
          .attr("x", (648 - 8))
          .attr("y", (413))
          .attr("font-size", "9px")
          .attr("id", "anlge3")
          .attr('class', 'Tangle')
          .attr("font-family", "Century Gothic")
          .attr("font-weight", "bold")
          .text('31' + "°");

          //LINE 4

        let LineGDJARA = grid.append("line")
          .attr('x1', 568+3)
          .attr('y1', 382+3)
          .attr('x2',615)
          .attr('y2', 460)
          .attr('z-index', 0)
          .attr("id", "line4")
          .attr('stroke-width', "3px")
          .attr('stroke', "gray")
          

        let line5 = grid.append("line")
          .attr('x1', 615)
          .attr('y1', 460)
          .attr('x2', 672-4)
          .attr('y2', 418+3)
          .attr("id", "line4")
          .attr('z-index', 0)
          .attr('stroke-width', "3px")
          .attr('stroke', "gray")

        grid.append("circle")
          .attr("cx", 615)
          .attr("cy", 460 -3)
          .attr("r", 13)
          .attr("id", "circle4")
          .attr("fill", "#DEDEDE")

        ang3 = grid.append("text")
          .attr("x", (615 - 8))
          .attr("y", (460))
          .attr("font-size", "9px")
          .attr("id", "anlge4")
          .attr('class', 'Tangle')
          .attr("font-family", "Century Gothic")
          .attr("font-weight", "bold")
          .text('31' + "°");

          //LINE 5

        let LineMZTLAN = grid.append("line")
          .attr('x1', 493+6)
          .attr('y1', 311+1)
          .attr('x2',625)
          .attr('y2', 350)
          .attr('z-index', 0)
          .attr("id", "line5")
          .attr('stroke-width', "3px")
          .attr('stroke', "gray")
          

        let LineMZTLAN2 = grid.append("line")
          .attr('x1', 625)
          .attr('y1', 350)
          .attr('x2', 672)
          .attr('y2', 418-2)
          .attr("id", "line6")
          .attr('z-index', 0)
          .attr('stroke-width', "3px")
          .attr('stroke', "gray")

        grid.append("circle")
          .attr("cx", 625)
          .attr("cy", 350)
          .attr("r", 13)
          .attr("id", "circle5")
          .attr("fill", "#DEDEDE")

        ang3 = grid.append("text")
          .attr("x", (616))
          .attr("y", (350 + 2))
          .attr("font-size", "9px")
          .attr("id", "anlge4")
          .attr('class', 'Tangle')
          .attr("font-family", "Century Gothic")
          .attr("font-weight", "bold")
          .text('23' + "°");

        //LINE 6

        let LineSLV = grid.append("line")
          .attr('x1', 912+1)
          .attr('y1', 557)
          .attr('x2',823)
          .attr('y2', 488)
          .attr('z-index', 0)
          .attr("id", "line7")
          .attr('stroke-width', "3px")
          .attr('stroke', "gray")
        

        grid.append("circle")
          .attr("cx", 858)
          .attr("cy", 515)
          .attr("r", 13)
          .attr("id", "circle6")
          .attr("fill", "#DEDEDE")

        ang3 = grid.append("text")
          .attr("x", (849))
          .attr("y", (518))
          .attr("font-size", "9px")
          .attr("id", "anlge4")
          .attr('class', 'Tangle')
          .attr("font-family", "Century Gothic")
          .attr("font-weight", "bold")
          .text('28' + "°");

        // CREATE LINE 2

        let LineCHPAS = grid.append("line")
          .attr('x1',818 )
          .attr('y1',481)
          .attr('x2', 674)
          .attr('y2', 420)
          .attr('z-index', -1)
          .attr('stroke-width', "3px")
          .attr('stroke', "grey")

         grid.append("circle")
          .attr("cx", 744)
          .attr("cy", 448)
          .attr("r", 13)
          .attr("id", "circle7")
          .attr("fill", "#DEDEDE")

        ang2 = grid.append("text")
          .attr("x", (744 - 8))
          .attr("y", (448 + 3))
          .attr("font-size", "9px")
          .attr("id", "anlge2")
          .attr('class', 'Tangle')
          .attr("font-family", "Century Gothic")
          .attr("font-weight", "bold")
          .text('24' + "°");


        let LineJRZ = grid.append("line")
        .attr('x1',495 )
        .attr('y1',83)
        .attr('x2', 618)
        .attr('y2', 272)
        .attr('z-index', -1)
        .attr('stroke-width', "3px")
        .attr('stroke', "grey")

        let LineJRZ2 = grid.append("line")
          .attr('x1', 618)
          .attr('y1', 272)
          .attr('x2', 672)
          .attr('y2', 418-2)
          .attr('z-index', 0)
          .attr('stroke-width', "3px")
          .attr('stroke', "gray")

        
        grid.append("circle")
          .attr("cx", 618)
          .attr("cy", 272)
          .attr("r", 13)
          .attr("id", "circle8")
          .attr("fill", "#DEDEDE")

       grid.append("text")
          .attr("x", (618 - 8))
          .attr("y", (272 + 3))
          .attr("font-size", "9px")
          .attr("id", "anlge2")
          .attr('class', 'Tangle')
          .attr("font-family", "Century Gothic")
          .attr("font-weight", "bold")
          .text('24' + "°");

      dots= grid.append("g")
        .attr("d", path)
        .attr("class", "dots")
        .style("z-index", 1);

        
        dots.selectAll("circle")
        .attr("d", path)
        .data(data)  
        .enter().append('circle') 
        .attr('id', function (d){return d.index} )
        .attr("r", 7)
        .attr("cx", function (d) {return projection([d.lon, d.lat])[0];})
        .attr("cy", function (d) {return projection([d.lon, d.lat])[1];})
        .attr("fill", function (d) {return d.fill})
        .attr('stroke-width', "1.5px")
        .attr('stroke', "gray")
        
        .on('mouseover', function(d, i) {
      // make the mouseover'd element
      
      // bigger and red
      var the_id = d3.select(this).attr('id')
      current_id = d.index
      d3.select(this)
        .transition()
        .duration(75)
        .attr('r', 15)
        .attr('fill', function (d) {
          color_loc = d.fill
          d3.select('.location')
         .attr('fill', color_loc)
         .attr('font-weight', 'bold');
          return d.fill});})
        .on('mouseout', function(d, i) {
          // return the mouseover'd element
          // to being smaller and black
          d3.select(this)
            .transition()
            .duration(75)
            .attr('r', 7)
            .attr('fill',  function (d) {return d.fill});
        })


        info=map_background_svg.append("g")
        .attr("d", path)
        .attr("class", "dots")
        .style("z-index", 1);

        var info_x =10
        var info_y = 50
        width1=width*0.15
        height1=height*0.3
      
        info.append('rect')
        .attr("fill", "rgba(255,255,255,0.4)")
        .attr("x", info_x)
        .attr("y", info_y)
        .attr("rx", 10)
        .attr("ry", 10)
        .attr("width",width1 )
        .attr("height",height1);
        
        info.append("text")
        .attr("font-size", "15px")
        .attr('fill', '#14213D')
        .attr('font-weight', 'bold')
        .text("Measurements")
        .attr("x", info_x+30)
        .attr("y", info_y+30);

        
        info.append("rect")
        .attr("fill", "rgba(255,255,255,0.4)")
        .attr("x", info_x+10)
        .attr('visibility', 'hidden') 
        .attr("y", info_y+40)
        .attr("rx", 0)
        .attr("ry", 0)
        .attr("width", width1*0.9)
        .attr("height", height1*0.7);





        data_inf=['location', 'lot', 'lan', 'frequency', 'voltage', 'angle']

        info_text=info.append('g')
        

        info_text.selectAll('text')
        .attr("d", path)
        .data(data_inf)  
        .enter().append('text')
        .attr("fill", "#EC3115")
        .attr("font-size", "13px")
        .attr('fill', '#14213D')
        .attr('font-weight', '400')
        .attr('font-weight', 'bold')
        .text(function (d) {return `${d}:`})
        .attr("x", info_x+20)
        .style('text-transform', 'capitalize')
        .attr("y", function (d,i) {return info_y+60+23*i});

        info_point=info.append('g')
        .attr('class', 'data')

        info_point.selectAll('text')
        .attr("d", path)
        .data(data_inf)  
        .enter().append('text')
        .attr("fill", "#EC3115")
        .attr("font-size", "13px")
        .attr('fill', '#14213D')
        .attr('font-weight', '400')
        .text('--')
        .attr("x", info_x+100)
        .attr('class', function (d) {return d})
        .style('text-transform', 'capitalize')
        .attr("y", function (d,i) {return info_y+60+23*i});
       
          }

  
      requestData(); // execute

      
      function getAngle() {
          const url = '/cict/app/angle/';
            fetch(url)
                .then( resultado => resultado.json())
                .then( datos => {
                    angleInfo= JSON.parse(datos.data);
                    angle=angleInfo.TimeSeriesDataPoints;
                    
                    [MOR, CHPAS, GUAD, CDMX, MTREY, MXTLAN, CHMAL, SLV] = angle;
                    /*175,11,63,90,85,58,53,68/json"
                    175: Morelia, Michoacan  DPMU
                    11: Morelia, Michoacan  1408 -- Chiapas
                    63: Guadalajara, Jalisco  1378
                    90: UNAM, Mexico City (old 44) 1385
                    85: Monterrey, Nuevo León 1389
                    58: Mazatlan, Sinaloa 1422
                    53: Chetumal, Quintana Roo 1424
                    68: El Salvador, El Salvador 1628 

                      for fq=1:Pt
                        if deltad(iter,Pt)>pi
                          deltad(iter,Pt)=deltad(iter,Pt)-2*pi;
                        end
                        if deltad(iter,Pt)<-pi
                          deltad(iter,Pt)=deltad(iter,Pt)+2*pi;
                        end
                    end 

                    angle=[CHMAL.Value,Math.abs(MTREY.Value)-Math.abs(CDMX.Value), Math.abs(MOR.Value)-Math.abs(CDMX.Value),
                    Math.abs( GUAD.Value)-Math.abs(CDMX.Value), Math.abs(MXTLAN.Value)-Math.abs(CDMX.Value), Math.abs(SLV.Value)-Math.abs(CHPAS.Value), 
                    Math.abs(CHPAS.Value)-Math.abs(CDMX.Value), Math.abs(CHPAS.Value)-Math.abs(CDMX.Value)] */


                    old_angle=[CHMAL.Value,MTREY.Value-CDMX.Value, MOR.Value-CDMX.Value, GUAD.Value-CDMX.Value, MXTLAN.Value-CDMX.Value, SLV.Value-CHPAS.Value, 
                    CHPAS.Value-CDMX.Value, CHPAS.Value-CDMX.Value]
                    

                  
                    angle = []

                    old_angle.forEach(function(value){
                      if (value > 180){
                        angle.push(value-360)
                      }
                      else if (value <-180){
                        angle.push(value+360)
                       
                      }
                      else {
                        angle.push(value)
                      }
                    })
                    
                   the_text=d3.selectAll(".text1")                

                    angleT=the_text.selectAll("text")
                    angleT.data(angle);
                    angleT.text(function(d) { return (`${Math.round(d, -1)}°`); }); 

                    valuerotate =[CHMAL.Value, MTREY.Value, MOR.Value, GUAD.Value, MXTLAN.Value, SLV.Value, CHPAS.Value,CHPAS.Value, CDMX.Value]
                     arrow_class = d3.select("#window_info")
                    arrow=arrow_class.selectAll('line')
                    //console.log(arrow)
                    arrow.data(valuerotate)
                    arrow.attr("transform", function(d) { return `rotate(${-d} 931 169)`}) 
                   
                    angle=[GUAD.Value, CDMX.Value, MTREY.Value,MOR.Value,MXTLAN.Value,CHMAL.Value, SLV.Value, CHPAS.Value, CHPAS.Value]
                })
              
                const url_freq = '/cict/app/frequency/';

                fetch(url_freq)
                    .then( resultado => resultado.json())
                    .then( datos => {
                        PMU= JSON.parse(datos.data);
                        perPMU=PMU.TimeSeriesDataPoints;
                        [MOR ,CHPAS, GUAD, CDMX, MTREY, MXTLAN, CHMAL, SLV] = perPMU;
                      
                        /*171,7,59,86,81,54,49,64/json"
                        171: Morelia, Michoacan  DPMU
                        7: Morelia, Michoacan  1408 --Chiapas
                        59: Guadalajara, Jalisco  1378
                        86: UNAM, Mexico City (old 44) 1385
                        81: Monterrey, Nuevo León 1389
                        54: Mazatlan, Sinaloa 1422
                        49: Chetumal, Quintana Roo 1424
                        64: El Salvador, El Salvador 1628 */
                        
                        Freq =[GUAD.Value, CDMX.Value, MTREY.Value,MOR.Value,MXTLAN.Value,CHMAL.Value, SLV.Value, CHPAS.Value, CHPAS.Value]
                        data=update_data()
                        //console.log(data)
                        dots.selectAll("circle").data(data)  
              
                    }) 
              
                    d3.select(".location").text(`${data[current_id].id}`)
                    d3.select(".lan").text(`${data[current_id].lat}°`)
                    d3.select(".lot").text(`${data[current_id].lon}°`)
                    d3.select(".frequency").text(`${(data[current_id].freq).toFixed(3)} Hz`)
                    d3.select(".angle").text(`${(data[current_id].angle).toFixed(2) }°`)
                    
              
             
              
              }
      
      $(document).ready(function(){
      setInterval(getAngle,1000);
      }); 
      
      
     
     
      </script>

<script src="{% static 'media/js/script.js'%}" ></script>
{% endblock %}
